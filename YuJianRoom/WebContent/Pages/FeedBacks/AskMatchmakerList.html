<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
	<title>申请红娘</title>
	<script src="/YuJianRoom/Contents/js/jquery.min.js" type="text/javascript"></script>
    <script src="/YuJianRoom/Contents/lib/jquery-easyui-1.5.2/jquery.easyui.min.js" type="text/javascript"></script>
    <link href="/YuJianRoom/Contents/lib/jquery-easyui-1.5.2/themes/default/easyui.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="/YuJianRoom/Contents/lib/jquery-easyui-1.5.2/themes/icon.css" />
</head>
<body>
    <table id="tt" title="申请列表" style="width:100%;height:100%"
           data-options='url:"/YuJianRoom/FeedBacks/GetList"
           ,fit:"true"
           ,nowrap:"false"
           ,toolbar:"#tb"
           ,fitColumns:"true"
		   ,rownumbers:"true"
           ,pagination:"true"'>
        <thead>
            <tr>
                <th data-options="field:'feedbackid',width:100,align:'center'">申请编号</th>
                <th data-options="field:'realname',width:100,align:'center'">申请用户</th>
                <th data-options="field:'userid',width:100,align:'center'">用户编号</th>
                <th data-options="field:'feedbackcontent',width:100,align:'center'">内容</th>
                <th data-options="field:'feedbacktime',width:100,align:'center'">申请时间</th>
                <th data-options="field:'feedbackresult',width:100,align:'center',formatter:FormatResult">处理结果</th>
                <th data-options="field:'feedbackstatus',width:100,align:'center',formatter:FormatStatus">状态</th>
            </tr>
        </thead>
    </table>
	
	<div id="tb" style="padding:5px;height:auto">
        <div>
			塞选条件：
			<select style="width: 80px" class="easyui-combobox" id="feedbackstatus" data-options="editable:false,panelHeight:'auto'">
				<option value="0" selected="selected">未处理</option>
				<option value="1">已处理</option>
			</select>
            <button onclick="LoadData()" type="button" class="easyui-linkbutton" data-options='iconCls:"icon-search"'>确定</button>
        </div>
    </div>
    
    
     <!-- 弹窗部分 -->
    <div id="CheckDialog" class="easyui-dialog" style="width:480px;height:600px"
         data-options="title:'用户基本信息',buttons:'#bb',modal:true,closed:true">
        <div style="padding:10px;">
        <form id="ff" action="" method="post" enctype="multipart/form-data" >
            <input id="userid" type="hidden" name="userid" />
            <input name="hotcount" type="hidden" />
            <input name="riches" type="hidden" />
            <input name="goldbalance" type="hidden" />
            <input name="createtime" type="hidden" />
            <input name="headimgurl" type="hidden" />
            <input name="videourl" type="hidden" />
            <input name="weixinuid" type="hidden" />
            <input name="weixinoid" type="hidden" />
            <input name="selectcondition" type="hidden" />
            <input name="matchmakerintroduct" type="hidden" />
            <input name="matchmakergoodat" type="hidden" />
            <input name="matchmakeradvise" type="hidden" />
            <table>
                <tr>
                    <td>姓名：</td>
                    <td>
                        <input id="realname" class="easyui-textbox" type="text" name="realname" readonly="readonly" data-options="required:true,validType:'length[1,40]'" />
                    </td>
                    <td width="20"></td>
                    <td>头像：</td>
                    <td>
                        <img id="headimgurl" src="" width="80" height="80">
                    </td>
                </tr>
                <tr>
                    <td>婚否：</td>
                    <td>
                       <select name="married" class="easyui-combobox" data-options="required:true,editable:false,panelHeight:'auto',readonly:true" style="width:80px">
                            <option value="0">未婚</option>
                            <option value="1">已婚</option>
                            <option value="2">保密</option>
                        </select>
                    </td>
                    <td></td>
                    <td>薪资：</td>
                    <td>
                         <select name="wage" class="easyui-combobox" data-options="editable:false,panelHeight:'auto',readonly:true" style="width:80px">
                            <option value="0-3000">0-3000</option>
                            <option value="3000-5000">3000-5000</option>
                            <option value="5000-8000">5000-8000</option>
                            <option value="8000-10000">8000-10000</option>
                            <option value="10000-20000">10000-20000</option>
                            <option value="20000+">20000+</option>
                        </select>
                    </td>
                </tr>
                <tr>
                 	<td>性别：</td>
                    <td>
                       <select name="sex" class="easyui-combobox" data-options="required:true,editable:false,panelHeight:'auto',readonly:true" style="width:80px">
                            <option value="0">女</option>
                            <option value="1">男</option>
                        </select>
                    </td>
                    <td></td>
                    <td>出生日期：</td>
                    <td>
                    	<input class="easyui-datebox" type="text" name="birthday" data-options="required:true,readonly:true" />
                    </td>
                </tr>
                <tr>
                 	<td>身高：</td>
                    <td>
                       	<select name="height" class="easyui-combobox" data-options="required:true,editable:false,panelHeight:'auto',readonly:true" style="width:80px">
							<option value="140-150">140-150</option>
							<option value="150-160">150-160</option>
							<option value="160-170">160-170</option>
							<option value="170-180">170-180</option>
							<option value="180-190">180-190</option>
							<option value="190-200">190-200</option>
						</select>
                    </td>
                    <td></td>
                    <td>地址：</td>
                    <td>
                    	<input class="easyui-textbox" type="text" name="address" data-options="required:true,validType:'length[1,40]',readonly:true" />
                    </td>
                </tr>
                <tr>
                 	<td>爱好：</td>
                    <td>
                       	<input class="easyui-textbox" type="text" name="hobby" data-options="required:true,validType:'length[1,40]',readonly:true" />
                    </td>
                    <td></td>
                    <td>职业：</td>
                    <td>
                    	<input class="easyui-textbox" type="text" name="occupation" data-options="required:true,validType:'length[1,40]',readonly:true" />
                    </td>
                </tr>
                <tr>
                 	<td>手机号：</td>
                    <td>
                       	<input id="phone" class="easyui-textbox" type="text" name="phone" data-options="required:true,validType:'length[1,20]',readonly:true" />
                    </td>
                    <td></td>
                    <td>微信号：</td>
                    <td>
                    	<input class="easyui-textbox" type="text" name="weixinnum" data-options="required:true,validType:'length[1,20]',readonly:true" />
                    </td>
                </tr>
                <tr>
                 	<td>QQ号：</td>
                    <td>
                       	<input class="easyui-textbox" type="text" name="qqnum" data-options="required:true,validType:'length[1,20]',readonly:true" />
                    </td>
                    <td></td>
                    <td>学历：</td>
                    <td>
                    	<select name="record" class="easyui-combobox" data-options="required:true,editable:false,panelHeight:'auto',readonly:true" style="width:80px">
                            <option value="小学">小学</option>
                            <option value="初中">初中</option>
                            <option value="高中">高中</option>
                            <option value="大专">大专</option>
                            <option value="本科">本科</option>
                            <option value="研究生">研究生</option>
                            <option value="硕士">硕士</option>
                            <option value="博士">博士</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>用户类型：</td>
                    <td>
                        <select name="usertype" class="easyui-combobox" data-options="required:true,editable:false,panelHeight:'auto',readonly:true" style="width:80px">
                            <option value="-2">红娘</option>
                            <option value="0">普通</option>
                            <option value="1">会员</option>
                            <option value="2">管理员</option>
                        </select>
                    </td>
                    <td></td>
                    <td>排序号：</td>
                    <td>
                        <input class="easyui-numberbox" type="number" name="usersortindex" data-options="required:true,validType:'length[1,40]',readonly:true" />
                    </td>
                </tr>
                 <tr>
                    <td>血型：</td>
                    <td>
                        <select name="bloodtype" class="easyui-combobox" data-options="editable:false,panelHeight:'auto',readonly:true" style="width:80px">
                            <option value="O">O</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="AB">AB</option>
                        </select>
                    </td>
                    <td></td>
                </tr>
            </table>
        </form>
        </div>
    </div>
    <div id="bb">
        <button type="button" onclick="Save(1)" data-options='iconCls:"icon-ok"' class="easyui-linkbutton">
		通过
        </button>
        <a onclick="Save(0)" data-options='iconCls:"icon-cancel"' class="easyui-linkbutton">
		不通过
        </a>
    </div>

    <script type="text/javascript">
        $(function () {
            LoadData()
        });
        
        $('#ff').form({
            onLoadSuccess:function(data){
            	if(data.headimgurl!=''){
            		$('#headimgurl').attr('src',data.headimgurl);
            	}
            	$('#CheckDialog').dialog('open');
            }
        });
        
        //执行处理结果
        function Save(val){
        	var id=$('#userid').val();
        	var rows = $('#tt').datagrid('getSelections');
        	var feedbackid = rows[0].feedbackid;
        	if(id==null||id==''||val==null)
        		return;
        	$.post('/YuJianRoom/FeedBacks/AskMatchmaker'
        			,{userid:id,ispass:val,feedbackid:feedbackid}
        			,function(data){
        	        	 $('#CheckDialog').dialog('close');
        				 $.messager.alert('提示', data, 'info');
                         $('#tt').datagrid('reload');
                         
                     	loadFeedbackCount();	//重载反馈数量
        			},'text');
        }

        function LoadData() {
            var pager= $('#tt').datagrid({ 
            	url: '/YuJianRoom/FeedBacks/GetList?feedbacktype=4&feedbackstatus='
            			+$('#feedbackstatus').val()
                }).datagrid('getPager');
            
            pager.pagination({
                showPageList: true,
                buttons: [ {
                    iconCls: 'icon-edit',
                    text:'审核资历',
                    handler: function (e) {
                   	 	var rows = $('#tt').datagrid('getSelections');
                        if (rows.length < 1) {
                            $.messager.alert('提示', '请至少选中一个选项', 'info');
                            return;
                        }
                        if(rows[0].feedbackstatus==1){
                        	$.messager.alert('提示','该项已处理');
                        	return;
                        }
                        
                    	$('#ff').form('load', '/YuJianRoom/Users/GetSingle?id=' + rows[0].userid);
                    }
                }, {
                    iconCls: 'icon-remove',
                    text:"删除",
                    handler: function () {
                    	DelClick();//删除-处理  
                    }
                }],
                onBeforeRefresh: function () {
                    return true;
                }
            });
        }
        
        function DelClick(){
        	var rows = $('#tt').datagrid('getSelections');
            if (rows.length < 1) {
                $.messager.alert('提示', '请至少选中一个选项', 'info');
                return;
            }
            var ids = '';
            for (var i = 0; i < rows.length; i++) {
                ids += rows[i].feedbackid + ","
            }
            ids = ids.substring(0, ids.length - 1);

            $.messager.confirm('系统提示', '您确定要删除编号为' + ids + '的数据吗?', function (r) {
                if (r) {
                    $.post('/YuJianRoom/FeedBacks/Del'
                        , { ids: ids }
                        , function (data) {
                            $.messager.alert('提示', data, 'info');
                            $('#tt').datagrid('reload');
                            
                            loadFeedbackCount();	//重载反馈数量
                        }, 'text');
                }
            });
        }
        
        function FormatStatus(val,row){
        	return val==0?'<span style="color:red">未处理</span>':'已处理';
        }
        
        function FormatResult(val,row){
        	switch(val){
        	case -1:return '未定义';
        	case 0:return '<span style="color:red">不通过</span>';
        	case 1:return '通过';
        	}
        }
    </script>
    <script src="/YuJianRoom/Contents/lib/jquery-easyui-1.5.2/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
</body>
</html>